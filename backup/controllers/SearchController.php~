<?php

class SearchController extends \BaseController {
	public function __construct (Orders $orders, Tasks $tasks, Reprojections $reprojections, Jobs $jobs, Invoices $invoices, Search $search)
	{
	
		$this->orders = $orders;
		$this->tasks = $tasks;
		$this->reprojections = $reprojections;	
		$this->jobs = $jobs;
		$this->invoices = $invoices;
		$this->search = $search;
	}
	/**
	 * Display a listing of the resource.
	 *
	 * @return Response
	 */
	public function index()
	{
		$search = Input::get('search');
		
		if(Auth::user()->user_role == 'Client'){
			
		//Search database for results
			
		$results = $this->search->ClientSearch($search);

		$search_results = array();
		
		//Loop through search results and find order id
		
		foreach($results['orders'] as $results_orders){
		
		$search_results[$results_orders->id] = DB::table('orders')->where('id', $results_orders->id)->first();
			
		}
		foreach($results['jobs'] as $results_jobs){

		$search_results[$results_jobs->order_id] = DB::table('orders')->where('id', $results_jobs->order_id)->first();
			
		}
		dd($search_results);	
		}
		
		View::make('search.index')->with(['results' => $results]);
	}


	/**
	 * Show the form for creating a new resource.
	 *
	 * @return Response
	 */
	public function create()
	{
		//
	}


	/**
	 * Store a newly created resource in storage.
	 *
	 * @return Response
	 */
	public function store()
	{
		//
	}


	/**
	 * Display the specified resource.
	 *
	 * @param  int  $id
	 * @return Response
	 */
	public function show($id)
	{
		//
	}


	/**
	 * Show the form for editing the specified resource.
	 *
	 * @param  int  $id
	 * @return Response
	 */
	public function edit($id)
	{
		//
	}


	/**
	 * Update the specified resource in storage.
	 *
	 * @param  int  $id
	 * @return Response
	 */
	public function update($id)
	{
		//
	}


	/**
	 * Remove the specified resource from storage.
	 *
	 * @param  int  $id
	 * @return Response
	 */
	public function destroy($id)
	{
		//
	}


}
